<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<link rel="icon" type="image/png" href="https://image2url.com/images/1762322252079-aae4fc0d-8c21-4a16-b6c6-ad616068a85d.png">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MedVault | Sign Up</title>
<style>
  body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin:0; padding:0; background:#f5faff; color:#333; }
  header { background: linear-gradient(90deg,#0d6efd,#20c997); color:white; padding:1rem 2rem; display:flex; justify-content:space-between; align-items:center; }
  header h1 { margin:0; font-size:1.5rem; }
  header nav { display:flex; gap:1rem; }
  header nav a { color:white; text-decoration:none; font-weight:600; background: rgba(255,255,255,0.2); padding:0.6rem 1.2rem; border-radius:8px; transition:0.3s; }
  header nav a:hover { background: rgba(255,255,255,0.35); transform: scale(1.05); }
  .container { display:flex; min-height:calc(100vh - 70px); }
  .welcome { flex:1; background:white; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:2rem; border-right:1px solid #e0e0e0; text-align:center; }
  .welcome img { max-width:280px; max-height:280px; margin-top:1rem; }
  .signup-section { flex:2; display:flex; align-items:center; justify-content:center; padding:2rem; }
  .card { background:white; padding:2rem; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1); width:100%; max-width:650px; }
  .card h2 { text-align:center; margin-bottom:1.5rem; color:#0d6efd; }
  .toggle { display:flex; margin-bottom:1.5rem; border-radius:8px; overflow:hidden; border:1px solid #ccc; }
  .toggle button { flex:1; padding:0.8rem; border:none; cursor:pointer; font-weight:bold; transition:0.3s; }
  .toggle button.active { background:#20c997; color:white; }
  .toggle button:not(.active) { background:#f8f9fa; color:#333; }
  form { display:none; }
  form.active { display:block; }
  .row { display:flex; gap:1rem; margin-bottom:1rem; flex-wrap:wrap; }
  .field { flex:1; display:flex; flex-direction:column; }
  label { font-weight:600; margin-bottom:0.3rem; font-size:0.9rem; }
  input, select { padding:0.7rem; border:1px solid #ccc; border-radius:8px; font-size:1rem; }
  .submit { width:100%; padding:0.9rem; background:#0d6efd; color:white; border:none; border-radius:8px; font-weight:bold; cursor:pointer; margin-top:1rem; transition:0.3s; }
  .submit:hover { background:#0b5ed7; }
  .message { margin-top:1rem; text-align:center; font-weight:bold; }
  .message.success { color:green; }
  .message.error { color:red; }
</style>
</head>
<body>

<header>
  <h1>MedVault</h1>
  <nav>
    <a href="index.html">Home</a>
    <a href="login.html">Login</a>
     <a href="contact.html">Contact Us</a>
  </nav>
</header>

<div class="container">
  <div class="welcome" id="welcomeSection">
    <h2 id="welcomeTitle">Welcome, Patient!</h2>
    <p id="welcomeText">Securely store and share your health records on MedVault.</p>
    <img id="welcomeImage" src="https://tse2.mm.bing.net/th/id/OIP.z2gQUbPSFNdhpTAw1ey6kQHaHa?pid=Api&P=0&h=220" alt="Healthcare">
  </div>

  <div class="signup-section">
    <div class="card">
      <h2>Sign Up</h2>
      <div class="toggle">
        <button id="patientBtn" class="active">Patient</button>
        <button id="doctorBtn">Doctor</button>
      </div>

      <!-- Patient Form -->
      <form id="patientForm" class="active">
        <div class="row">
          <div class="field"><label>Full Name</label><input type="text" name="fullName" required></div>
          <div class="field"><label>Date of Birth</label><input type="date" name="dob" required></div>
        </div>
        <div class="row">
          <div class="field"><label>Phone Number</label><input type="tel" name="phone" pattern="[0-9]{10}" required></div>
          <div class="field"><label>Email</label><input type="email" name="email" required></div>
        </div>
        <div class="row">
          <div class="field"><label>Height (cm)</label><input type="number" name="height" required></div>
          <div class="field"><label>Weight (kg)</label><input type="number" name="weight" required></div>
        </div>
        <div class="field">
          <label>Blood Group</label>
          <select name="bloodGroup" required>
            <option value="">Select</option>
            <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
            <option>AB+</option><option>AB-</option><option>O+</option><option>O-</option>
          </select>
        </div>
        <div class="row">
          <div class="field"><label>Password</label><input type="password" name="password" id="patientPassword" required></div>
          <div class="field"><label>Confirm Password</label><input type="password" name="confirmPassword" id="patientConfirmPassword" required></div>
        </div>
        <button type="submit" class="submit">Sign Up</button>
        <div class="message" id="patientMessage"></div>
      </form>

      <!-- Doctor Form -->
      <form id="doctorForm">
        <div class="row">
          <div class="field"><label>Full Name</label><input type="text" name="fullName" required></div>
          <div class="field"><label>Date of Birth</label><input type="date" name="dob" required></div>
        </div>
        <div class="row">
          <div class="field"><label>NMC Registration No.</label><input type="text" name="nmcRegNo" required></div>
          <div class="field"><label>State Medical Council</label><input type="text" name="stateMedicalCouncil" required></div>
        </div>
        <div class="field"><label>Hospital Address</label><input type="text" name="hospitalAddress" required></div>
        <div class="field"><label>Speciality</label><input type="text" name="speciality" required></div>
        <div class="row">
          <div class="field"><label>Email</label><input type="email" name="email" required></div>
          <div class="field"><label>Phone Number</label><input type="tel" name="phone" pattern="[0-9]{10}" required></div>
        </div>
        <div class="row">
          <div class="field"><label>Password</label><input type="password" name="password" id="doctorPassword" required></div>
          <div class="field"><label>Confirm Password</label><input type="password" name="confirmPassword" id="doctorConfirmPassword" required></div>
        </div>
        <div class="field"><label>MetaMask Wallet Address (optional)</label><input type="text" name="walletAddress"></div>
        <button type="submit" class="submit">Sign Up</button>
        <div class="message" id="doctorMessage"></div>
      </form>

    </div>
  </div>
</div>

<script>
const patientBtn = document.getElementById("patientBtn");
const doctorBtn = document.getElementById("doctorBtn");
const patientForm = document.getElementById("patientForm");
const doctorForm = document.getElementById("doctorForm");
const welcomeTitle = document.getElementById("welcomeTitle");
const welcomeText = document.getElementById("welcomeText");
const welcomeImage = document.getElementById("welcomeImage");

// âœ… Toggle
patientBtn.onclick = () => {
  patientBtn.classList.add("active");
  doctorBtn.classList.remove("active");
  patientForm.classList.add("active");
  doctorForm.classList.remove("active");
  welcomeTitle.textContent = "Welcome, Patient!";
  welcomeText.textContent = "Securely store your medical records.";
  welcomeImage.src = "https://tse2.mm.bing.net/th/id/OIP.z2gQUbPSFNdhpTAw1ey6kQHaHa?pid=Api&P=0&h=220";
};

doctorBtn.onclick = () => {
  doctorBtn.classList.add("active");
  patientBtn.classList.remove("active");
  doctorForm.classList.add("active");
  patientForm.classList.remove("active");
  welcomeTitle.textContent = "Welcome, Doctor!";
  welcomeText.textContent = "Register to treat patients & access records.";
  welcomeImage.src = "https://cdn-icons-png.flaticon.com/512/387/387561.png";
};

// âœ… Backend URL Auto select
const API_BASE_URL =
  location.hostname.includes("localhost")
    ? "http://localhost:5001"
    : "https://medvault-backend-vfsu.onrender.com";

// âœ… Password rule
function validatePassword(password) {
  return /^(?=.*[A-Z])(?=.*[!@#$%^&*(),.?":{}|<>]).{8,}$/.test(password);
}

// âœ… SUBMIT function (fixed)
async function submitForm(form, endpoint, messageDiv) {
  const data = Object.fromEntries(new FormData(form).entries());

  if (!validatePassword(data.password)) {
    messageDiv.textContent = "Password must have 8+ chars, 1 uppercase & 1 special symbol!";
    messageDiv.className = "message error";
    return;
  }
  if (data.password !== data.confirmPassword) {
    messageDiv.textContent = "Passwords do not match!";
    messageDiv.className = "message error";
    return;
  }

  try {
    const res = await fetch(`${API_BASE_URL}${endpoint}`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });

    const result = await res.json();

    messageDiv.textContent = res.ok
      ? `âœ… Registered! Your ID: ${result.patientId || result.doctorId}`
      : `âŒ ${result.error}`;

    messageDiv.className = res.ok ? "message success" : "message error";
    if (res.ok) form.reset();

  } catch (e) {
    messageDiv.textContent = "ðŸš¨ Server unreachable!";
    messageDiv.className = "message error";
  }
}

// âœ… Add submit listeners
patientForm.addEventListener("submit", e => {
  e.preventDefault();
  submitForm(patientForm, "/api/auth/signup/patient", patientMessage);
});

doctorForm.addEventListener("submit", e => {
  e.preventDefault();
  submitForm(doctorForm, "/api/auth/signup/doctor", doctorMessage);
});
</script>

</body>
</html>
